# ドキュメント管理システム 要件定義書

## 1. プロジェクト概要

### 1.1 背景・課題

- 歴史的経緯により組織構造が複数回変更され、文書のフォルダパスが不統一
- 複数の命名規則が混在し、文書の所在管理が困難
- 人員の部署移動履歴により、過去文書へのアクセス権限管理が複雑
- 文書の存在確認（本体・承認書）の手動確認が非効率

### 1.2 目的

組織変遷と人員異動を考慮した統合的なドキュメントフォルダパス管理システムの構築により、効率的な文書管理と検索を実現する。

### 1.3 スコープ

- **対象**: ネットワークドライブ上の文書フォルダパス管理
- **除外**: 文書ファイル自体の内容管理・バージョン管理
- **期間**: 開発期間4ヶ月（16週間）、段階的リリース

## 2. 機能要件

### 2.1 文書基盤管理機能

| ID    | 要件                     | EARS形式                                                                                                           |
| ----- | ------------------------ | ------------------------------------------------------------------------------------------------------------------ |
| F001  | ルールベース文書番号生成 | システムは文書作成日・文書種別・部署・課が入力された場合、適用可能な生成ルールを選択し一意の文書番号を生成する     |
| F001a | 歴史的番号形式対応       | システムは時期・部署・文書種別に応じて複数の番号形式（CTA-2508001、技術-25001、DA-25001等）に対応する              |
| F001b | 番号生成ルール管理       | システムは番号生成ルール（テンプレート・有効期間・優先度）を動的に管理し、条件に応じて適切なルールを適用する       |
| F001c | 例外番号処理             | システムは標準ルールで生成困難な場合、管理者による手動番号設定を許可し、重複チェックを実行する                     |
| F001d | 連番管理                 | システムは各ルール・年月・部署の組み合わせで独立した連番を管理し、ルール別に定義された桁数でゼロ埋め番号を生成する |
| F002  | 版管理                   | システムは既存文書番号に対して改訂版(r1,r2...)またはドラフト版(d1,d2...)の番号を付与する                           |
| F003  | フォルダパス管理         | システムは各文書番号に対してネットワークドライブのフォルダパスを適切なルールで解決・提供する                       |
| F003a | ルールベースパス生成     | システムはルールベースでネットワークパスを動的生成し、サーバー名・共有フォルダ構造を管理する                       |
| F003b | ファイルアクセス権除外   | システムはファイルサーバー側でのファイルアクセス権管理に依存し、本システムではファイルレベルの権限制御を行わない   |
| F004  | パスルール履歴管理       | システムはパス生成ルールの変更履歴を管理し、過去の時点での正確なパス再現を可能とする                               |

### 2.2 組織・人員管理機能

| ID    | 要件               | EARS形式                                                                                               |
| ----- | ------------------ | ------------------------------------------------------------------------------------------------------ |
| F005  | 組織構造管理       | システムは部・課の階層構造と組織改編履歴を時系列で管理する                                             |
| F005a | 部署コード管理     | システムは部署コード（1文字）と部署名の対応テーブルを動的に管理し、歴史的変遷に対応する                |
| F005b | 課コード管理       | システムは課コード（1文字）と課名の対応テーブルを動的に管理し、組織改編に対応する                      |
| F006  | 人員異動履歴       | システムは各人員の部署所属履歴（開始日・終了日）を管理し、兼務・出向にも対応する                       |
| F007  | Windows AD連携     | システムはWindows Active Directoryと標準連携し、社員番号ベースでの人員管理を行う                       |
| F007a | AD同期・監視       | システムは週次でActive Directoryを監視し、ユーザー追加・削除を検知してローカルデータベースを更新する   |
| F007b | ローカル人員DB管理 | システムは独自の人員データベースを保持し、AD情報（社員番号・氏名・メール・ADユーザー名）を同期保存する |
| F007c | 論理削除対応       | システムはADでユーザー削除時もローカルDBでは論理削除（is_activeフラグ）とし、履歴データを保持する      |
| F008  | 権限継承検索       | システムは利用者の過去所属部署の文書も検索対象に含める                                                 |

### 2.3 ファイル存在確認機能

| ID    | 要件               | EARS形式                                                                                                  |
| ----- | ------------------ | --------------------------------------------------------------------------------------------------------- |
| F009  | 文書存在確認       | システムは月次で各文書番号に対応するフォルダパスの存在を確認する                                          |
| F010  | 承認書確認         | システムは承認書要否文書について、承認書ファイル([文書番号]-審査承認.pdf)の存在を確認する                 |
| F010a | 文書種別意味管理   | システムは文書種別コード（A,B,X,D等）と意味的分類（報告書、議事録等）を動的に管理し、承認書要否を制御する |
| F010b | 承認書要否制御     | システムはユーザーが文書作成時または編集時に承認書の配布方法を設定可能とし、必要性を制御する              |
| F011  | 確認除外設定       | システムは管理者が設定した年月日・部署の組み合わせテーブルに基づいて文書の存在確認を除外する              |
| F012  | エラー通知         | システムはパス不存在・ファイル不存在時にメールまたはTeams通知を送信する                                   |
| F012a | 通知タイミング制御 | システムはシステムアラート・回覧時は即時通知、リマインドは定時通知を行う                                  |
| F012b | 通知対象者決定     | システムは通知種別に応じて適切な対象者（作成者・管理者・回覧先）を自動決定する                            |

### 2.4 検索・閲覧機能

| ID    | 要件           | EARS形式                                                                                                           |
| ----- | -------------- | ------------------------------------------------------------------------------------------------------------------ |
| F013  | 多条件検索     | システムは文書種別・業務番号・タイトル・作成者での組み合わせ検索を提供する                                         |
| F014  | 履歴検索       | システムは過去の組織所属履歴を考慮した文書検索を実行する                                                           |
| F015  | 機密制御       | システムは利用者の権限に応じて機密レベル（社内外・重要度・個人情報有無の組み合わせ）の文書表示を制御する           |
| F015a | 機密レベル管理 | システムは文書の機密レベルを社内外区分・重要度・個人情報有無の3軸で管理し、管理者による動的設定を可能とする        |
| F015b | 機密レベル定義 | システムは各軸をenum型で定義し日本語名と1:1対応させる（社内外：社内/社外、重要度：情報クラスⅠ/Ⅱ、個人情報：無/有） |
| F016  | パス表示切替   | システムは機密レベルに応じてフォルダパスの表示・非表示を制御する                                                   |

### 2.5 業務従事者管理機能

| ID   | 要件             | EARS形式                                                                   |
| ---- | ---------------- | -------------------------------------------------------------------------- |
| F021 | 業務従事者登録   | システムは各業務に従事する人員を役割・参加レベル・期間と共に登録する       |
| F022 | 業務メンバー管理 | システムは業務従事者の追加・変更・履歴管理を時系列で記録する               |
| F023 | 回覧候補提案     | システムは文書の業務番号から従事者を自動抽出し、回覧候補として提案する     |
| F024 | 外部連絡先管理   | システムは業務に関連する外部連絡先（顧客・協力会社）を管理し回覧対象とする |

### 2.6 高度検索機能

| ID   | 要件               | EARS形式                                                                         |
| ---- | ------------------ | -------------------------------------------------------------------------------- |
| F025 | 社員高度検索       | システムは名前・部署・役職・業務従事履歴での複合条件による社員検索を提供する     |
| F026 | 業務高度検索       | システムは業務番号・名前・期間・従事者・顧客での複合条件による業務検索を提供する |
| F027 | オートコンプリート | システムは検索入力時に部分文字列マッチングによる候補を動的に表示する             |
| F028 | 段階的絞り込み     | システムは部署→課→個人の階層的選択による段階的絞り込み機能を提供する             |
| F029 | 検索履歴保存       | システムは利用者の検索条件をお気に入りとして保存・再利用機能を提供する           |

### 2.7 柔軟回覧機能

| ID   | 要件           | EARS形式                                                                     |
| ---- | -------------- | ---------------------------------------------------------------------------- |
| F030 | 階層化回覧候補 | システムは業務従事者・部署メンバー・全社員・外部連絡先の階層的候補を提案する |
| F031 | 一括回覧設定   | システムは提案候補からの一括選択・個別除外による効率的な回覧設定を提供する   |
| F032 | 回覧履歴活用   | システムは過去の回覧履歴から類似パターンを学習し候補として提案する           |
| F033 | 外部回覧対応   | システムは外部メールアドレスへの直接回覧とステータス管理を提供する           |

### 2.8 データ移行・名寄せ機能

| ID    | 要件             | EARS形式                                                                           |
| ----- | ---------------- | ---------------------------------------------------------------------------------- |
| F034  | CSV取込み        | システムは既存文書情報のCSVファイルを取り込み、データベースに格納する              |
| F035  | 業務番号重複管理 | システムは同一業務番号の重複使用を検出し、使用回数を管理することで一意性を確保する |
| F035a | 業務番号循環管理 | システムは業務番号が上限（99990）に達した場合の循環再利用（10000に戻る）を管理する |
| F036  | 作成者名寄せ     | システムは作成者名の表記ゆれを検出し、社員番号による統合を提案する                 |
| F037  | 顧客名寄せ       | システムは顧客名の表記ゆれを検出し、統合候補を提示する                             |

### 2.9 文書種別管理機能

| ID    | 要件                   | EARS形式                                                                                              |
| ----- | ---------------------- | ----------------------------------------------------------------------------------------------------- |
| F038  | 動的文書種別管理       | システムは文書種別コード（A,B,C,D,Q,R,X等）と意味的分類を動的に管理し、時期・部署による変更に対応する |
| F038a | 文書種別意味マッピング | システムは文書種別コードから意味的分類（報告書、議事録、入手文書等）へのマッピングを管理する          |
| F038b | 承認書要否動的制御     | システムは文書種別の意味的分類に基づいて承認書の要否を動的に制御する                                  |

**文書種別コード例（現在の標準）**：

- A：報告書
- B：顧客提出文書  
- C：社内文書
- D：入手文書
- Q：QMS関連文書
- R：稟議書
- X：議事録

**注記**：上記コードと意味の対応は歴史的に変遷しており、時期・部署により異なる場合がある。システムはこれらの変遷を動的に管理する。

### 2.10 ルールベース生成管理機能

| ID    | 要件               | EARS形式                                                                                     |
| ----- | ------------------ | -------------------------------------------------------------------------------------------- |
| F039  | 生成ルール統合管理 | システムは文書番号生成・パス生成の両ルールを統合的に管理し、条件変更時の一括更新を可能とする |
| F039a | ルール優先度制御   | システムは複数適用可能ルールが存在する場合、優先度に基づいて自動選択する                     |
| F039b | ルール有効期間管理 | システムはルールの有効期間を管理し、期間外ルールの自動無効化と警告通知を行う                 |
| F039c | ルール依存関係管理 | システムは文書番号ルールとパス生成ルールの依存関係を管理し、整合性を保証する                 |

## 3. 非機能要件

### 3.1 性能要件

| 項目             | 要件                                       | 測定方法               |
| ---------------- | ------------------------------------------ | ---------------------- |
| 応答時間         | 検索応答2秒以内                            | 平均応答時間測定       |
| 同時接続数       | 最大10ユーザー                             | 負荷テスト             |
| データ容量       | 30年分の文書情報（約5万件、年間約1,700件） | ストレージ容量計測     |
| メタデータサイズ | 1文書あたり平均1KB程度のメタデータ         | データベースサイズ測定 |
| ファイル確認性能 | 1万件/時間の存在確認                       | バッチ処理時間測定     |

### 3.2 可用性要件

| 項目       | 要件                        | 対策                   |
| ---------- | --------------------------- | ---------------------- |
| 稼働時間   | 平日8-18時 99%稼働          | 冗長化・監視           |
| 復旧時間   | 障害発生から4時間以内復旧   | バックアップ・復旧手順 |
| データ保全 | 日次バックアップ、1ヶ月保持 | 自動バックアップ       |

### 3.3 セキュリティ要件

| 項目       | 要件                   | 実装方針             |
| ---------- | ---------------------- | -------------------- |
| 認証       | AD統合認証             | Windows認証          |
| 認可       | 役割ベースアクセス制御 | 部署・機密レベル対応 |
| 通信暗号化 | HTTPS通信              | TLS1.3以上           |
| 監査ログ   | アクセス・変更ログ記録 | ログ管理機能         |

### 3.4 保守性要件

| 項目         | 要件                     | 対策               |
| ------------ | ------------------------ | ------------------ |
| コード品質   | テストカバレッジ80%以上  | 単体・結合テスト   |
| ドキュメント | API仕様・運用手順書整備  | 自動生成・更新     |
| 監視         | システム状態・エラー監視 | ログ監視・アラート |

## 4. 制約・前提条件

### 4.1 技術制約

| 項目             | 制約内容                         | 影響                   |
| ---------------- | -------------------------------- | ---------------------- |
| プラットフォーム | Windows Server環境               | 技術選定制限           |
| ネットワーク     | 既存ファイルサーバー利用         | アクセス方式制限       |
| 認証基盤         | AD連携（JSON認証フォールバック） | 段階的認証実装         |
| データベース     | SQLite → SQL Server移行可        | 段階的スケーリング対応 |

### 4.2 運用制約

| 項目             | 制約内容         | 対応策           |
| ---------------- | ---------------- | ---------------- |
| メンテナンス時間 | 平日19-22時のみ  | 自動化・短時間化 |
| 利用者教育       | 最小限の操作研修 | 直感的UI設計     |
| データ移行期間   | 1ヶ月以内完了    | 段階的移行計画   |

### 4.3 データ制約

| 項目           | 制約内容           | 対策               |
| -------------- | ------------------ | ------------------ |
| 既存データ品質 | 表記ゆれ・重複多数 | 名寄せ機能実装     |
| 履歴データ     | 部分的欠損         | 段階的補完         |
| 命名規則変遷   | 複数世代の規則混在 | 柔軟なパターン対応 |

## 5. エッジケース・例外処理

### 5.1 データ異常系

| ケース           | 条件               | 期待動作                 |
| ---------------- | ------------------ | ------------------------ |
| 重複文書番号     | 同一番号が既存     | エラー表示・代替番号提案 |
| 無効フォルダパス | 存在しないパス指定 | 警告表示・確認要求       |
| 不正文字列       | パスに使用不可文字 | 自動除去・警告表示       |

### 5.2 ネットワーク異常系

| ケース               | 条件             | 期待動作                   |
| -------------------- | ---------------- | -------------------------- |
| ファイルサーバー不通 | ネットワーク切断 | エラーログ・リトライ       |
| AD認証失敗           | 認証サーバー障害 | ローカル認証フォールバック |
| タイムアウト         | 応答遅延         | タイムアウト設定・再実行   |

### 5.3 ユーザー操作異常系

| ケース         | 条件                     | 期待動作               |
| -------------- | ------------------------ | ---------------------- |
| 権限外アクセス | 機密文書への不正アクセス | アクセス拒否・ログ記録 |
| 不正入力       | SQLインジェクション等    | 入力検証・無害化       |
| 大量データ要求 | 検索結果過多             | ページング・制限       |

## 6. 受け入れ基準

### 6.1 機能受け入れ基準

#### 6.1.1 文書番号生成システム

1. **ルールベース生成**: 10種類以上の歴史的形式パターンでの正常生成（100%成功率）
2. **例外番号処理**: 手動番号設定時の重複チェック機能動作確認
3. **連番管理**: 各ルール・年月・部署組み合わせでの独立連番管理確認
4. **版管理**: r1/d1形式での版番号自動生成確認

#### 6.1.2 検索・閲覧機能

1. **多条件検索**: 文書種別・業務番号・タイトル・作成者の4軸組み合わせ検索で期待結果取得（精度95%以上）
2. **履歴検索**: 過去所属部署文書への検索アクセス成功（権限継承確認）
3. **機密制御**: 3軸機密レベル（社内外・重要度・個人情報）での表示制御確認

#### 6.1.3 ファイル存在確認

1. **月次バッチ**: 月次での全文書パス存在確認完了（エラー率5%以下）
2. **承認書確認**: 承認書要否文書での審査承認.pdf確認機能動作
3. **除外設定**: 指定年月日・部署での確認除外機能動作

#### 6.1.4 データ移行・名寄せ

1. **CSV取込み**: 5万件規模データの正常取込み（エラー率1%以下）
2. **業務番号重複**: 同一番号の使用回数管理での一意性確保
3. **名寄せ機能**: 作成者・顧客名表記ゆれの90%以上正確検出

### 6.2 性能受け入れ基準

1. **応答時間**: 検索応答2秒以内を95%以上達成（1000件検索条件）
2. **同時処理**: 10ユーザー同時アクセスでの正常動作（レスポンス劣化20%以内）
3. **バッチ処理**: 1万件/時間の存在確認処理達成
4. **データ容量**: 5万件データでの検索性能維持確認
5. **メタデータ処理**: 1文書1KB想定での50MBデータベースサイズ制限内動作

### 6.3 セキュリティ受け入れ基準

1. **認証**: AD統合による自動ログイン（認証失敗時のフォールバック動作確認）
2. **認可**: 機密レベル別アクセス制御確認（不正アクセス試行での適切拒否）
3. **監査**: 全操作のログ記録確認（作成・更新・削除・検索の完全記録）
4. **通信暗号化**: HTTPS通信での全データ転送確認

### 6.4 運用受け入れ基準

1. **可用性**: 平日8-18時の99%稼働達成（月間ダウンタイム1時間以内）
2. **復旧時間**: 障害発生から4時間以内復旧（バックアップからの復旧含む）
3. **バックアップ**: 日次自動バックアップの正常実行確認
4. **監視**: システム状態・エラーの自動監視・通知機能動作確認

## 7. データ設計詳細

### 7.1 文書番号生成ルール設定テーブル

| 項目                 | 内容             | 例                                 |
| -------------------- | ---------------- | ---------------------------------- |
| ルールID             | 一意識別子       | RULE_001                           |
| ルール名             | 表示名           | "技術部標準形式2025"               |
| テンプレート         | 生成パターン     | "{部署コード}-{年下2桁}{連番:3桁}" |
| 連番桁数             | ゼロ埋め桁数     | 3                                  |
| 適用条件（部署）     | 対象部署コード   | "TA"                               |
| 適用条件（文書種別） | 対象文書種別     | "A,B,X"                            |
| 有効期間開始         | ルール開始日     | 2025-01-01                         |
| 有効期間終了         | ルール終了日     | NULL（無期限）                     |
| 優先度               | 競合時の優先順位 | 1（高優先）                        |

### 7.2 ネットワークパス生成ルール設定テーブル

| 項目             | 内容           | 例                                           |
| ---------------- | -------------- | -------------------------------------------- |
| パスルールID     | 一意識別子     | PATH_001                                     |
| ルール名         | 表示名         | "技術部標準パス2025"                         |
| パステンプレート | 生成パターン   | "\\server01\docs\{年}\{部署名}\{文書種別名}" |
| 適用条件（部署） | 対象部署コード | "T"                                          |
| 適用条件（年）   | 対象年範囲     | 2025-2030                                    |
| 有効期間開始     | ルール開始日   | 2025-01-01                                   |
| 有効期間終了     | ルール終了日   | NULL                                         |

### 7.3 文書種別意味マッピングテーブル

| 項目           | 内容                    | 例         |
| -------------- | ----------------------- | ---------- |
| マッピングID   | 一意識別子              | MAP_001    |
| 文書種別コード | 1文字コード             | "A"        |
| 意味的分類     | 日本語分類名            | "報告書"   |
| 承認書要否     | デフォルト設定          | true       |
| 適用部署       | 対象部署（NULL=全部署） | NULL       |
| 適用期間開始   | 有効開始日              | 2020-01-01 |
| 適用期間終了   | 有効終了日              | NULL       |

### 7.4 存在確認除外設定テーブル

| 項目           | 内容                        | 例                       |
| -------------- | --------------------------- | ------------------------ |
| 除外設定ID     | 一意識別子                  | EXC_001                  |
| 除外基準日     | この日以前を除外            | 2020-03-31               |
| 対象部署コード | 除外対象部署（NULL=全部署） | "O"                      |
| 除外理由       | 設定理由                    | "旧システム移行前データ" |
| 設定日         | 設定実施日                  | 2025-01-15               |

## 8. 技術スタック詳細

### 8.1 採用技術

| 技術領域           | 選定技術                     | 選定理由                     |
| ------------------ | ---------------------------- | ---------------------------- |
| **フロントエンド** | SvelteKit + TypeScript       | 軽量・高速・型安全           |
| **スタイリング**   | Tailwind CSS                 | ユーティリティファースト     |
| **デスクトップ**   | Tauri                        | 軽量・セキュア・Web共有      |
| **Webサーバー**    | Axum (Rust)                  | 軽量・柔軟・マルチDB対応     |
| **API**            | GraphQL                      | 効率的データ取得・型安全     |
| **データアクセス** | SQLx + マイグレーション      | マルチDB対応・移行容易       |
| **データベース**   | SQLite → SQL Server (移行可) | 開発：軽量、本格運用：高性能 |

### 8.2 段階的実装方針

- **Phase 1**: JSON認証 + SQLite (開発・小規模運用)
- **Phase 2**: AD連携 + SQLite (中規模運用)
- **Phase 3**: AD連携 + SQL Server (本格運用・高負荷対応)

## 9. 参考文献

- 既存文書管理規程（社内資料）
- Active Directory設計書（社内資料）
- ネットワークドライブ構成図（社内資料）
- ISO 27001情報セキュリティ管理基準
